# hw definition file for processing by chibios_pins.py

# MCU class and specific type
MCU STM32L431 STM32L431xx

# bootloader starts firmware at 36k + 4k (STORAGE_FLASH)
FLASH_RESERVE_START_KB 40

# ChibiOS system timer
STM32_ST_USE_TIMER 15
define CH_CFG_ST_RESOLUTION 16

# store parameters in pages 18 and 19
STORAGE_FLASH_PAGE 18
define HAL_STORAGE_SIZE 800

# board ID for firmware load
APJ_BOARD_ID 1046

# setup build for a peripheral firmware
env AP_PERIPH 1

# crystal frequency
OSCILLATOR_HZ 16000000

# assume the 128k flash part
FLASH_SIZE_KB 256

# order of UARTs
SERIAL_ORDER USART2 USART1

STDOUT_SERIAL SD2
STDOUT_BAUDRATE 57600

# USART1, telemetry
PA9  USART1_TX USART1 NODMA
PA10 USART1_RX USART1 NODMA

# USART2, debug
PA2 USART2_TX USART2
PA3 USART2_RX USART2

# LEDs
PA1 LED OUTPUT LOW

# debugger support
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

# enable CAN support
PA11 CAN1_RX CAN1
PA12 CAN1_TX CAN1

define HAL_CAN_POOL_SIZE 6000

# only one I2C bus in normal config
PB6 I2C1_SCL I2C1
PB7 I2C1_SDA I2C1

define HAL_USE_I2C TRUE
define STM32_I2C_USE_I2C1 TRUE
I2C_ORDER I2C1
define HAL_I2C_INTERNAL_MASK 0

define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER TRUE

define HAL_NO_MONITOR_THREAD
define HAL_NO_LOGGING
define HAL_NO_GPIO_IRQ
define HAL_NO_RCIN_THREAD

define HAL_USE_RTC FALSE
define DISABLE_SERIAL_ESC_COMM TRUE

define DMA_RESERVE_SIZE 0

define HAL_DEVICE_THREAD_STACK 768

# stack for fast interrupts
define PORT_INT_REQUIRED_STACK 64

# MAIN_STACK is stack for ISR handlers
MAIN_STACK 0x300

# PROCESS_STACK controls stack for main thread
PROCESS_STACK 0xA00

define HAL_DISABLE_LOOP_DELAY

define AP_PARAM_MAX_EMBEDDED_PARAM 128

# keep ROMFS uncompressed as we don't have enough RAM
# to uncompress the bootloader at runtime
env ROMFS_UNCOMPRESSED True

define CAN_APP_NODE_NAME "org.ardupilot.GWIND.GPS"

COMPASS IST8310 I2C:0:0x0E false ROTATION_YAW_90

# disable dual GPS and GPS blending to save flash space
define GPS_MAX_RECEIVERS 1
define GPS_MAX_INSTANCES 1
define HAL_COMPASS_MAX_SENSORS 1

# GPS+MAG+BARO+LEDs
define HAL_PERIPH_ENABLE_GPS
define HAL_PERIPH_ENABLE_MAG
define HAL_PERIPH_ENABLE_NOTIFY
define HAL_PERIPH_ENABLE_RC_OUT

# GPS on 2nd port
define HAL_PERIPH_GPS_PORT_DEFAULT 1

define AP_COMPASS_AK09916_ENABLED 0
define AP_COMPASS_AK8963_ENABLED 0
define AP_COMPASS_BMM150_ENABLED 0
define AP_COMPASS_BMM150_DETECT_BACKENDS_ENABLED 0
define AP_COMPASS_HMC5843_ENABLED 0
define AP_COMPASS_ICM20948_ENABLED 0
define AP_COMPASS_IST8308_ENABLED 0
define AP_COMPASS_LIS3MDL_ENABLED 0
define AP_COMPASS_LSM303D_ENABLED 0
define AP_COMPASS_LSM9DS1_ENABLED 0
define AP_COMPASS_MAG3110_ENABLED 0
define AP_COMPASS_MMC3416_ENABLED 0
define AP_COMPASS_MMC5XX3_ENABLED 0
define AP_COMPASS_QMC5883L_ENABLED 0
define AP_COMPASS_RM3100_ENABLED 0

define AP_GPS_ERB_ENABLED 0
define AP_GPS_GSOF_ENABLED 0
define AP_GPS_NMEA_ENABLED 0
define AP_GPS_NMEA_UNICORE_ENABLED 0
define AP_GPS_NOVA_ENABLED 0
define AP_GPS_SBF_ENABLED 0
define AP_GPS_SBP_ENABLED 0
define AP_GPS_SBP2_ENABLED 0
define AP_GPS_SIRF_ENABLED 0
define AP_GPS_SIRF_ENABLED 0


